<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

	<changeSet id="007-1" author="gooamoko">
		<comment>
			Добавим порядковый номер в таблицу модулей
		</comment>
		<sql>
			ALTER TABLE modules ADD mod_number int NOT NULL DEFAULT 0;
		</sql>
	</changeSet>
	<changeSet id="007-2" author="gooamoko">
		<comment>
			Добавим порядковый номер в таблицу дисциплин
		</comment>
		<sql>
			ALTER TABLE subjects ADD sub_number int NOT NULL DEFAULT 0;
		</sql>
	</changeSet>
	<changeSet id="007-3" author="gooamoko">
		<comment>
			Добавим таблицу сообщений
		</comment>
		<sql>
			CREATE TABLE messages(
			msg_pcode serial,
			msg_from varchar(255) NOT NULL,
			msg_srcaccount int NULL,
			msg_dstaccount int NOT NULL,
			msg_title varchar(255) NOT NULL,
			msg_text text NOT NULL,
			msg_datetime timestamp NOT NULL DEFAULT now(),
			msg_received boolean NOT NULL DEFAULT false,
			msg_deleted boolean NOT NULL DEFAULT false,
			CONSTRAINT messages_pk PRIMARY KEY(msg_pcode),
			CONSTRAINT messages_accounts_src_fk FOREIGN KEY(msg_srcaccount) REFERENCES accounts(aco_pcode) ON UPDATE CASCADE ON DELETE CASCADE,
			CONSTRAINT messages_accounts_dst_fk FOREIGN KEY(msg_dstaccount) REFERENCES accounts(aco_pcode) ON UPDATE CASCADE ON DELETE CASCADE);
		</sql>
	</changeSet>

</databaseChangeLog>